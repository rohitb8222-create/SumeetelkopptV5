<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1024"> 
    <title>Sumeet Elko - Final HD Editor</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    
    <style>
        :root { --blue: #1e3a8a; --accent: #3b82f6; --dark: #000; }
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a1a; margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; color: white; }
        
        #theme-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; display: flex; justify-content: center; align-items: center; }
        .theme-modal { background: #1a1a1a; padding: 30px; border-radius: 20px; border: 2px solid var(--accent); text-align: center; max-width: 800px; }
        .theme-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 25px; }
        .theme-item { width: 220px; height: 125px; background: #333; border: 3px solid #444; cursor: pointer; border-radius: 10px; overflow: hidden; transition: 0.3s; position: relative; }
        .theme-item img { width: 100%; height: 100%; object-fit: cover; }
        .theme-item:hover { border-color: var(--accent); transform: scale(1.05); }
        .theme-item span { position: absolute; bottom: 5px; left: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 8px; font-size: 12px; border-radius: 4px; }
        
        .top-fixed-section { position: sticky; top: 0; width: 100%; background: var(--dark); z-index: 2000; border-bottom: 3px solid var(--accent); display: flex; flex-direction: column; }
        .header { padding: 10px; text-align: center; border-bottom: 1px solid #333; }
        .btn-panel { display: flex; gap: 10px; justify-content: center; }
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; font-size: 13px; text-transform: uppercase; }
        .btn-add { background: var(--accent); }
        .btn-pdf { background: #10b981; border: 2px solid #fff; }

        .sidebar { width: 100%; height: 130px; background: #111; overflow-x: auto; display: flex; padding: 15px; gap: 20px; align-items: center; }
        .thumb-wrapper { display: flex; flex-direction: column; align-items: center; gap: 5px; flex-shrink: 0; cursor: grab; }
        .thumb-box { width: 140px; height: 80px; background: #fff; border: 2px solid #555; border-radius: 4px; overflow: hidden; }
        .thumb-box img { width: 100%; height: 100%; object-fit: cover; }
        .thumb-num { font-size: 11px; background: #333; padding: 2px 8px; border-radius: 10px; }

        .editor { flex: 1; background: #222; overflow: auto; display: flex; flex-direction: column; align-items: center; padding: 50px 0; }
        #container { transform-origin: top center; transition: 0.3s; width: 100%; display: flex; flex-direction: column; align-items: center; }

        .slide {
            width: 960px; height: 540px; 
            background-size: 100% 100%; background-repeat: no-repeat;
            background-color: white; position: relative; 
            box-shadow: 0 0 50px rgba(0,0,0,0.8); flex-shrink: 0; 
            margin-bottom: 100px; color: #000; overflow: hidden;
        }

        .draggable-text { position: absolute; cursor: move; padding: 5px; z-index: 20; }
        .main-t { font-family: 'Impact', sans-serif; font-size: 70px; color: var(--blue); line-height: 1.1; outline: none; text-transform: uppercase; }
        .sub-t { font-size: 24px; font-weight: bold; color: #333; outline: none; }
        
        .slide-heading { position: absolute; top: 35px; left: 0; width: 100%; text-align: center; font-size: 32px; font-weight: bold; color: var(--blue); outline: none; text-transform: uppercase; display: none; }
        .photo-grid { display: flex; width: 90%; height: 60%; gap: 20px; position: absolute; top: 110px; left: 5%; }
        .photo-item { flex: 1; height: 100%; border: 8px solid white !important; box-shadow: 0 10px 25px rgba(0,0,0,0.4); position: relative; background: #eee; cursor: grab; }
        .photo-item img { width: 100%; height: 100%; object-fit: fill; pointer-events: none; }

        .text-overlay { position: absolute; bottom: 20px; left: 20px; background: rgba(0,0,0,0.9); color: white; padding: 6px 20px; font-size: 22px; font-weight: bold; display: none; }
        .label-modal { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 12px; display: none; flex-direction: column; gap: 10px; z-index: 5000; border: 3px solid var(--accent); color: #000; }
        .select-btn { background: #111; color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; }

        .slide-ctrl, .photo-actions { position: absolute; top: 15px; right: 15px; display: flex; gap: 10px; z-index: 100; }
        .mini-btn { font-size: 12px; padding: 6px 12px; background: rgba(0,0,0,0.85); color: white; border: none; border-radius: 6px; cursor: pointer; }

        #loader { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; flex-direction: column; justify-content: center; align-items: center; font-size: 24px;}
        .p-bar { width: 60%; height: 10px; background: #333; border-radius: 10px; overflow: hidden; margin-top:15px; }
        .p-fill { width: 0%; height: 100%; background: var(--accent); transition: 0.1s; }
    </style>
</head>
<body>

<div id="theme-overlay">
    <div class="theme-modal">
        <h2 style="color:var(--accent); margin:0;">SELECT REPORT THEME</h2>
        <div class="theme-grid" id="theme-grid"></div>
        <div style="margin-top:25px; border-top: 1px solid #444; padding-top:20px;">
            <input type="file" id="custom-bg-input" accept="image/*" style="display:none" onchange="handleCustomBg(this)">
            <button class="btn" style="background:#10b981; width:100%; padding:15px;" onclick="document.getElementById('custom-bg-input').click()">üìÅ Use Custom Background</button>
        </div>
    </div>
</div>

<div id="loader">
    <div id="status">HD ‡§∞‡•á‡§Ç‡§°‡§∞‡§ø‡§Ç‡§ó ‡§∏‡•Å‡§∞‡•Ç ‡§Ü‡§π‡•á...</div>
    <div class="p-bar"><div id="pFill" class="p-fill"></div></div>
</div>

<div class="top-fixed-section">
    <div class="header">
        <div class="btn-panel">
            <input type="file" id="files" accept="image/*" multiple style="display:none" onchange="addPhotoSlides()">
            <button class="btn btn-add" onclick="document.getElementById('files').click()">üì∑ Add Photo Slides</button>
            <button class="btn btn-add" style="background:#f59e0b" onclick="addIntro()">üìÑ Add Intro</button>
            <button class="btn btn-pdf" onclick="downloadMasterHD()">üì• Download PDF</button>
        </div>
    </div>
    <div class="sidebar" id="sidebar"></div>
</div>

<div class="editor" id="editor">
    <div id="container"></div>
</div>

<script>
    let selectedBg = ""; 
    const container = document.getElementById('container');
    const sidebar = document.getElementById('sidebar');

    // --- ‡§¶‡•Å‡§∞‡•Å‡§∏‡•ç‡§§ ‡§ï‡•á‡§≤‡•á‡§≤‡•ç‡§Ø‡§æ RAW ‡§≤‡§ø‡§Ç‡§ï‡•ç‡§∏ ---
    const backgrounds = [
        "https://raw.githubusercontent.com/rohitb8222-create/SumeetelkopptV5/fc0ad259898ea7365db0106cc4e264abfc034ccd/bg1.jpg",
        "https://raw.githubusercontent.com/rohitb8222-create/SumeetelkopptV5/fc0ad259898ea7365db0106cc4e264abfc034ccd/bg2.jpg",
        "https://raw.githubusercontent.com/rohitb8222-create/SumeetelkopptV5/fc0ad259898ea7365db0106cc4e264abfc034ccd/bg3.jpg",
        "https://raw.githubusercontent.com/rohitb8222-create/SumeetelkopptV5/fc0ad259898ea7365db0106cc4e264abfc034ccd/bg4.jpg",
        "https://raw.githubusercontent.com/rohitb8222-create/SumeetelkopptV5/fc0ad259898ea7365db0106cc4e264abfc034ccd/bg5.jpg",
        "https://raw.githubusercontent.com/rohitb8222-create/SumeetelkopptV5/fc0ad259898ea7365db0106cc4e264abfc034ccd/bg6.jpg"
    ];

    window.onload = () => {
        const grid = document.getElementById('theme-grid');
        backgrounds.forEach((url, i) => {
            const item = document.createElement('div');
            item.className = 'theme-item';
            item.onclick = () => applyTheme(url);
            item.innerHTML = `<img src="${url}" crossorigin="anonymous" onerror="this.src='https://via.placeholder.com/220x125?text=Link+Error'"><span>Theme ${i+1}</span>`;
            grid.appendChild(item);
        });
        addIntro(); 
        adjustScale();
        initDrag();
    };

    new Sortable(sidebar, {
        animation: 150,
        onEnd: function () {
            const wrappers = document.querySelectorAll('.thumb-wrapper');
            wrappers.forEach(w => container.appendChild(document.getElementById(w.dataset.id)));
            updateNums();
        }
    });

    function applyTheme(url) {
        selectedBg = url;
        document.getElementById('theme-overlay').style.display = 'none';
        document.querySelectorAll('.slide').forEach(s => {
            s.style.backgroundImage = `url(${selectedBg})`;
        });
    }

    function handleCustomBg(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => applyTheme(e.target.result);
            reader.readAsDataURL(input.files[0]);
        }
    }

    function initDrag() {
        interact('.draggable-text').draggable({
            listeners: {
                move (event) {
                    var target = event.target;
                    var x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
                    var y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;
                    target.style.transform = `translate(${x}px, ${y}px)`;
                    target.setAttribute('data-x', x);
                    target.setAttribute('data-y', y);
                }
            }
        });
    }

    function addIntro() {
        const id = 's-' + Date.now();
        const div = document.createElement('div');
        div.className = 'slide'; div.id = id;
        if(selectedBg) div.style.backgroundImage = `url(${selectedBg})`;
        div.innerHTML = `
            <div class="slide-ctrl">
                <button class="mini-btn" style="background:#3b82f6" onclick="addExtraText('${id}')">‚ûï Add Extra Text</button>
                <button class="mini-btn" style="background:red" onclick="removeSlide('${id}')">X</button>
            </div>
            <div class="draggable-text" style="left:70px; top:180px;">
                <div class="main-t" contenteditable="true" spellcheck="false">DEEP CLEANING DRIVE</div>
                <div class="sub-t" contenteditable="true" spellcheck="false">Work Report: Cleaning & Maintenance</div>
            </div>
        `;
        container.prepend(div);
        createThumb(id, null, true);
        initDrag();
        updateNums();
    }

    async function addPhotoSlides() {
        const files = Array.from(document.getElementById('files').files);
        for (let i = 0; i < files.length; i += 2) {
            const id = 's-' + Date.now() + i;
            const div = document.createElement('div');
            div.className = 'slide'; div.id = id;
            if(selectedBg) div.style.backgroundImage = `url(${selectedBg})`;
            div.innerHTML = `
                <div class="slide-ctrl">
                    <button class="mini-btn" style="background:#3b82f6" onclick="showHeading('${id}')">‚ûï Add Heading</button>
                    <button class="mini-btn" style="background:red" onclick="removeSlide('${id}')">X</button>
                </div>
                <div class="slide-heading" contenteditable="true">LOCATION NAME HERE</div>
                <div class="photo-grid"></div>
            `;
            const grid = div.querySelector('.photo-grid');
            const imgData1 = await loadImg(files[i], grid);
            if (files[i+1]) await loadImg(files[i+1], grid);
            container.appendChild(div);
            createThumb(id, imgData1, false);
            new Sortable(grid, { group: 'photos', animation: 200 });
        }
        updateNums();
    }

    function loadImg(f, p) {
        return new Promise(res => {
            const r = new FileReader();
            r.onload = e => {
                const item = document.createElement('div'); item.className = 'photo-item';
                item.innerHTML = `<img src="${e.target.result}"><div class="text-overlay">BEFORE</div>
                    <div class="label-modal">
                        <button class="select-btn" onclick="setLabel(this,'BEFORE')">BEFORE</button>
                        <button class="select-btn" onclick="setLabel(this,'AFTER')">AFTER</button>
                        <button class="select-btn" style="background:#f59e0b" onclick="setLabel(this,'')">‚ùå CLEAR</button>
                        <button class="select-btn" style="background:red" onclick="this.parentElement.style.display='none'">CLOSE</button>
                    </div>
                    <div class="photo-actions">
                        <button class="mini-btn" onclick="changeImg(this)">üîÑ Change</button>
                        <button class="mini-btn" onclick="this.closest('.photo-item').querySelector('.label-modal').style.display='flex'">LABEL</button>
                    </div>`;
                p.appendChild(item); res(e.target.result);
            }; r.readAsDataURL(f);
        });
    }

    function addExtraText(slideId) {
        const slide = document.getElementById(slideId);
        const extraDiv = document.createElement('div');
        extraDiv.className = 'sub-t draggable-text';
        extraDiv.style.left = '70px'; extraDiv.style.top = '300px'; 
        extraDiv.contentEditable = "true"; extraDiv.innerText = "Add extra info here...";
        slide.appendChild(extraDiv);
        initDrag();
    }

    function showHeading(id) {
        const heading = document.getElementById(id).querySelector('.slide-heading');
        heading.style.display = 'block'; heading.focus();
    }

    function setLabel(btn, txt) {
        const o = btn.closest('.photo-item').querySelector('.text-overlay');
        o.innerText = txt; o.style.display = txt ? 'block' : 'none';
        btn.parentElement.style.display = 'none';
    }

    function createThumb(id, imgData, isFirst) {
        const w = document.createElement('div'); w.className = 'thumb-wrapper';
        w.dataset.id = id;
        w.innerHTML = `<div class="thumb-box" onclick="document.getElementById('${id}').scrollIntoView({behavior:'smooth',block:'center'})">${imgData ? `<img src="${imgData}">` : `<div style="font-size:10px; padding:20px; color:#333; text-align:center;">INTRO</div>`}</div><div class="thumb-num"></div>`;
        if(isFirst) sidebar.prepend(w);
        else sidebar.appendChild(w);
    }

    function updateNums() {
        document.querySelectorAll('.thumb-wrapper').forEach((w, i) => {
            const num = w.querySelector('.thumb-num');
            if(num) num.innerText = i + 1;
        });
    }

    function removeSlide(id) {
        const slide = document.getElementById(id);
        if(slide) slide.remove();
        const thumb = document.querySelector(`.thumb-wrapper[data-id="${id}"]`);
        if(thumb) thumb.remove();
        updateNums();
    }

    function changeImg(btn) {
        const inp = document.createElement('input'); inp.type = 'file'; inp.accept = 'image/*';
        inp.onchange = e => {
            const r = new FileReader();
            r.onload = ev => btn.closest('.photo-item').querySelector('img').src = ev.target.result;
            r.readAsDataURL(e.target.files[0]);
        };
        inp.click();
    }

    async function downloadMasterHD() {
        const slides = document.querySelectorAll('.slide'); if(!slides.length) return;
        const thId = 'thanks-' + Date.now();
        const thDiv = document.createElement('div');
        thDiv.className = 'slide'; thDiv.id = thId;
        if(selectedBg) thDiv.style.backgroundImage = `url(${selectedBg})`;
        thDiv.innerHTML = `<div style="height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center;"><div style="font-size:100px; font-family:'Impact'; color:var(--blue);">THANK YOU!</div></div>`;
        container.appendChild(thDiv);

        document.getElementById('loader').style.display = 'flex';
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('l', 'px', [960, 540]);
        const updatedSlides = document.querySelectorAll('.slide');

        for (let i = 0; i < updatedSlides.length; i++) {
            document.getElementById('status').innerText = `Rendering: ${i+1}/${updatedSlides.length}`;
            document.getElementById('pFill').style.width = `${((i+1)/updatedSlides.length)*100}%`;
            updatedSlides[i].querySelectorAll('.slide-ctrl, .photo-actions, .label-modal').forEach(el => el.style.visibility = 'hidden');
            const canvas = await html2canvas(updatedSlides[i], { scale: 3, useCORS: true });
            updatedSlides[i].querySelectorAll('.slide-ctrl, .photo-actions, .label-modal').forEach(el => el.style.visibility = 'visible');
            if (i > 0) doc.addPage();
            doc.addImage(canvas.toDataURL('image/jpeg', 0.9), 'JPEG', 0, 0, 960, 540);
        }
        doc.save(`Sumeet_Report_${Date.now()}.pdf`);
        document.getElementById('loader').style.display = 'none';
        thDiv.remove();
    }

    function adjustScale() {
        const editorWidth = document.getElementById('editor').clientWidth - 60;
        const scale = editorWidth < 960 ? editorWidth / 960 : 1;
        container.style.transform = `scale(${scale})`;
    }
</script>
</body>
</html>
